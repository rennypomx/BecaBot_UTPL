{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - BecaBot UTPL</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{% static 'css/admin.css' %}">
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-content">
            <div class="spinner-border spinner-border-lg text-primary" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
            <p class="mt-3 mb-0" id="loading-text">Cargando...</p>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <button class="sidebar-toggle" id="sidebar-toggle">
            <i class="bi bi-chevron-double-right"></i>
        </button>
        <h4>ADMIN BECAS</h4>
        <nav class="nav flex-column" id="sidebar-nav">

            <a class="nav-link nav-ajax" href="{% url 'admin_panel' %}" data-link>
                <i class="bi bi-speedometer2"></i>
                <span class="nav-text">Dashboard</span>
            </a>

            <a class="nav-link nav-ajax" href="{% url 'admin_corpus' %}" data-link>
                <i class="bi bi-file-earmark-code"></i>
                <span class="nav-text">Corpus JSON</span>
            </a>

            <a class="nav-link nav-ajax" href="{% url 'admin_pdf' %}" data-link>
                <i class="bi bi-file-earmark-pdf"></i>
                <span class="nav-text">Documentos PDF</span>
            </a>

            <a class="nav-link nav-ajax" href="{% url 'admin_messages' %}" data-link>
                <i class="bi bi-chat-dots"></i>
                <span class="nav-text">Mensajes</span>
            </a>

            <a class="nav-link nav-ajax" href="{% url 'admin_scraping' %}" data-link>
                <i class="bi bi-arrow-repeat"></i>
                <span class="nav-text">Scraping</span>
            </a>

            <hr style="border-color: rgba(255,255,255,0.3);">

            <a class="nav-link" href="{% url 'home' %}">
                <i class="bi bi-arrow-left-circle"></i>
                <span class="nav-text">Volver al Chat</span>
            </a>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">

        <!-- Alerts Container (vacío por defecto, se llena dinámicamente) -->
        <div id="alerts-container"></div>

        <!-- Dynamic Content -->
        <div id="dynamic-content" class="content-fade">
            {% block content %}
                {% if initial_content %}
                    {{ initial_content|safe }}
                {% endif %}
            {% endblock %}
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{% static 'js/spa.js' %}"></script>
    <script src="{% static 'js/admin.js' %}"></script>
    <script>
        // Sidebar Toggle - Standalone
        (function() {
            const sidebar = document.getElementById('sidebar');
            const toggleBtn = document.getElementById('sidebar-toggle');
            
            console.log('Sidebar element:', sidebar);
            console.log('Toggle button:', toggleBtn);
            
            if (toggleBtn && sidebar) {
                toggleBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    console.log('Classes before toggle:', sidebar.className);
                    
                    if (sidebar.classList.contains('collapsed')) {
                        sidebar.classList.remove('collapsed');
                    } else {
                        sidebar.classList.add('collapsed');
                    }
                    
                    console.log('Classes after toggle:', sidebar.className);
                    
                    // Save state
                    const isCollapsed = sidebar.classList.contains('collapsed');
                    localStorage.setItem('sidebarCollapsed', isCollapsed);
                    console.log('Sidebar is now collapsed:', isCollapsed);
                });
            } else {
                console.error('Sidebar or toggle button not found!');
            }
            
            // Restore state
            setTimeout(function() {
                const savedState = localStorage.getItem('sidebarCollapsed');
                console.log('Saved state:', savedState);
                if (savedState === 'true' && sidebar) {
                    sidebar.classList.add('collapsed');
                    console.log('Restored collapsed state');
                }
            }, 100);
        })();
    </script>
</body>
</html>
